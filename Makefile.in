###
### Makefile.in for byte-compile
###
### Author:  Mew developing team
### Created: Nov 18, 1994
### Revised: Feb 10, 2023

###
### (1)   Set the following variables as you like.
### (2)   make
### (2.1) make info
### (2.2) make jinfo
### (3)   make install
### (3.1) make install-jinfo
###

################################################################
##
## EDIT THE FOLLOWINGS
##

prefix=@prefix@
exec_prefix=@exec_prefix@
libdir=@libdir@
datadir=@datadir@
infodir=@infodir@

##
## Compile engines
##

EMACS = @emacsbin@

##
## A directory where mew*.el[c] will be installed.
##

elispdir = @elispdir@
#elispdir = $(prefix)/share/emacs/site-lisp/mew
#elispdir = $(prefix)/lib/emacs

##
## A directory where etc file will be installed.
##

etcdir = @etcdir@
#etcdir = $(prefix)/share/emacs/site-lisp/mew/etc

DETECT = emacs

CP = cp
RM = rm -f
MKDIR = mkdir -p
# To save Emacses on Windows
PWD =

CNF = config.h config.status config.cache config.log configure.lineno
MK  = Makefile

DESTDIR =

################################################################

.PHONY: all
all: elisp bin

.PHONY: install
install: install-elisp install-bin install-info install-etc

################################################################

.PHONY: elisp
elisp:
	cd elisp; $(MAKE) EMACS=$(EMACS)

.PHONY: install-elisp
install-elisp:
	cd elisp; $(MAKE) install EMACS=$(EMACS) elispdir=$(elispdir) DESTDIR=$(DESTDIR)

################################################################

.PHONY: detect
detect:
	cd elisp; $(MAKE) detect EMACS=$(EMACS)

################################################################

.PHONY: bin
bin:
	cd bin; $(MAKE)

.PHONY: install-bin
install-bin:
	cd bin; $(MAKE) install DESTDIR=$(DESTDIR)

################################################################

.PHONY: info
info:
	cd info; $(MAKE) info EMACS=$(EMACS)

.PHONY: install-info
install-info:
	cd info; $(MAKE) install-info infodir=$(infodir) DESTDIR=$(DESTDIR)

################################################################

.PHONY: jinfo
jinfo:
	cd info; $(MAKE) jinfo EMACS=$(EMACS)

.PHONY: install-jinfo
install-jinfo:
	cd info; $(MAKE) install-jinfo infodir=$(infodir) DESTDIR=$(DESTDIR)

################################################################

.PHONY: install-etc
install-etc:
	-@if [ ! -d $(DESTDIR)$(etcdir) ]; then \
		$(MKDIR) $(DESTDIR)$(etcdir); \
	fi
	cd etc; $(CP) -r * $(DESTDIR)$(etcdir)/

################################################################

.PHONY: clean
clean:
	-@if [ -f elisp/Makefile ]; then \
		cd elisp; $(MAKE) clean; \
	fi
	-@if [ -f bin/Makefile ]; then \
		cd bin; $(MAKE) clean; \
	fi

.PHONY: distclean
distclean:
	$(RM) $(CNF) $(MK)
	-@if [ -f elisp/Makefile ]; then \
		cd elisp; $(MAKE) distclean; \
	fi
	-@if [ -f bin/Makefile ]; then \
		cd bin; $(MAKE) distclean; \
	fi

################################################################
##
## For github users
##

# git fetch
# make log     to see logs of updates
# make diff    to see the updates
# git pull

.PHONY: log
log:
	git log HEAD..FETCH_HEAD

.PHONY: diff
diff:
	git diff HEAD..FETCH_HEAD

VERSION = `git tag --sort=authordate | tail -1 | sed -e 's/v//'`

.PHONY: archive
archive:
	git archive master -o ~/mew-$(VERSION).tar --prefix=mew-$(VERSION)/
	gzip ~/mew-$(VERSION).tar

##
## End of Makefile
##
